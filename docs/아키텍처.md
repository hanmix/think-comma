# 아키텍처 개요

## 전체 흐름(Flow)
- 입력: `WorryInput` – 사용자의 고민 입력 및 검증
- 질문: `QuestionFlow` – 10개 A/B 질문, 진행률/네비게이션/접근성
- 분석: `QuestionFlow` 내 분석 모달(TcDialog) – 진행 단계·프로그레스
- 결과: `AnalysisResult` – 성향/결정요인/추천/행동계획
- 컨트롤러: `ThinkingProcess` – 단계 전환, 세션/에러/로딩 관리

## 디렉터리 구조 요약
```
src/
  components/
    thinking/   # WorryInput, QuestionFlow, AnalysisResult, ThinkingProcess
    ui/         # Tc* UI 컴포넌트 (Button, Card, Input, Modal, Dialog, ...)
  composables/  # 재사용 가능한 Composition API 훅 (예: useNavStack)
  views/        # 페이지 단위 컴포넌트 (Home, Example, DesignSystem, ThinkingFlow)
  styles/       # SCSS 엔트리와 전역 유틸 (_variables, _mixins, _global, _utilities, _components)
  assets/styles # 디자인 시스템 CSS 변수 + DS 컴포넌트 SCSS
  services/     # aiService (모의)
  types/        # thinking.ts (핵심 타입)
  stores/       # Pinia 스토어 (예: navStack)
  router/       # index.ts (라우팅), navStackSync.ts (스택 동기화 훅)
```

## 라우팅
- `/` → `HomePage`
- `/example` → `ExamplePage`
- `/flow` → `ThinkingFlow`
- `/design` → `DesignSystem`

## 상태/세션
- Vue 3 Composition API 표준 사용. 전역 상태는 Pinia(Setup Store)로 최소한만 사용
- `src/stores/navStack.ts`에 네비게이션 스택 상태를 보관(Setup Store)
- `ThinkingProcess`가 세션 로딩/저장/복구를 담당
- LocalStorage 활용 (필요 시 교체 용이)

## 네비게이션(스택 모델)
- 목표: SwiftUI `NavigationStack` 유사한 스택 기반 내비게이션을 웹에서 모방
- 구성 요소
  - `src/composables/useNavStack.ts`: `push/replace/pop/popToRoot/resetTo` API 제공, `canGoBack/depth` 계산
  - `src/stores/navStack.ts`: 스택과 히스토리 position 추적(Pinia Setup Store)
  - `src/router/navStackSync.ts`: `router.afterEach`로 브라우저 제스처(뒤/앞)와 스택 동기화
  - 라우트 메타: `meta.stackId`로 스택 식별, `meta.isRoot`로 루트 라우트 지정
- 동작 원리
  - 일반 이동은 Router를 호출하고, afterEach 훅이 `history.state.position`을 읽어 스택을 갱신
  - `pop()`은 `router.go(-1)`, `popToRoot()`는 현재 스택 깊이만큼 `router.go(-(n-1))`로 브라우저 히스토리와 일치
  - 기본 스택 ID는 `main`이며, 홈 라우트는 `isRoot: true`

## 타입 시스템 (`src/types/thinking.ts`)
- `WorryInput`, `Question`, `UserResponse`, `AnalysisResult`, `ThinkingSession`

## 서비스 (`src/services/aiService.ts`)
- 질문 생성/응답 분석 모의 구현
- 네트워크 API로 전환 시, 동일 인터페이스 유지 추천

## 접근성(A11y)
- 포커스 가시성(`:focus-visible`)과 최소 터치 타깃(44px)
- 모달(`TcModal`) 포커스 트랩/ESC/스크롤 잠금
- 입력 레이블/aria 속성/에러 메시지 연결

## 코드 규칙
- `@` 별칭 절대 경로 사용
- `<script setup lang="ts">` + SFC 사용
- UI 컴포넌트는 `Tc` 접두사
- 페이지/컴포넌트 스타일은 옆에 `.scss` 파일로 분리

## 테스트/빌드
- Vite + TypeScript (strict)
- 빌드 전 `vue-tsc -b`
- 테스트 프레임워크 미구성 (추가 예정 시 `vitest` 권장)
